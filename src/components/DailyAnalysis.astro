---
import Card from './ui/Card.astro';
import Badge from './ui/Badge.astro';
import { Sparkles, TrendingUp, Zap } from 'lucide-react';

interface FocusEvent {
  title: string;
  summary: string;
  why: string;
  impact: string;
}

interface Keywords {
  [key: string]: number;
}

interface Props {
  analysis: {
    focus_events: FocusEvent[];
    overview: string;
    keywords: Keywords;
  };
}

const { analysis } = Astro.props;
const maxWeight = Math.max(...Object.values(analysis.keywords || {}));
---

<section class="bg-slate-50 rounded-2xl p-6 md:p-8 border border-slate-200 shadow-inner">
  <div class="text-center mb-10">
    <div class="inline-flex items-center gap-2 px-4 py-1.5 rounded-full bg-brand-primary/10 text-brand-primary font-medium text-sm mb-4">
      <Sparkles size={16} />
      <span>AI 深度洞察</span>
    </div>
    <h2 class="text-2xl font-bold text-slate-900 mb-4">智能分析报告</h2>
    <p class="text-slate-600 leading-relaxed max-w-2xl mx-auto text-lg">
      {analysis.overview}
    </p>
  </div>

  <div class="mb-12">
    <h3 class="flex items-center gap-2 text-xl font-bold text-slate-900 mb-6">
      <Zap className="text-amber-500" />
      今日焦点
    </h3>
    <div class="grid gap-6 md:grid-cols-2">
      {analysis.focus_events?.map((event, index) => (
        <Card class="relative overflow-hidden border-slate-200">
          <div class="absolute -top-4 -right-4 text-9xl font-black text-slate-100 select-none z-0">
            {index + 1}
          </div>
          <div class="relative z-10 p-6">
            <h4 class="text-lg font-bold text-slate-900 mb-3 pr-8">{event.title}</h4>
            <p class="text-slate-600 mb-6 text-sm leading-relaxed">{event.summary}</p>
            
            <div class="space-y-3">
              <div class="bg-slate-50 p-3 rounded-lg border-l-4 border-brand-primary text-sm text-slate-700">
                <strong class="block text-brand-primary mb-1 text-xs uppercase tracking-wider">Why it matters</strong>
                {event.why}
              </div>
              <div class="bg-slate-50 p-3 rounded-lg border-l-4 border-brand-secondary text-sm text-slate-700">
                <strong class="block text-brand-secondary mb-1 text-xs uppercase tracking-wider">Impact</strong>
                {event.impact}
              </div>
            </div>
          </div>
        </Card>
      ))}
    </div>
  </div>

  <div>
    <h3 class="flex items-center gap-2 text-xl font-bold text-slate-900 mb-6">
      <TrendingUp className="text-rose-500" />
      热度关键词
    </h3>
    <div class="flex flex-wrap justify-center gap-3 p-8 bg-white rounded-xl border border-slate-200 shadow-sm">
      {Object.entries(analysis.keywords || {})
        .sort(([, a], [, b]) => b - a)
        .map(([keyword, weight]) => {
          const fontSize = 0.85 + (weight / maxWeight) * 1.0; // 0.85rem ~ 1.85rem
          const opacity = 0.5 + (weight / maxWeight) * 0.5;
          return (
            <span 
              class="font-bold text-brand-primary transition-all hover:scale-110 cursor-default"
              style={`font-size: ${fontSize}rem; opacity: ${opacity}`}
            >
              {keyword}
            </span>
          );
        })}
    </div>
  </div>
</section>
