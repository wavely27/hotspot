---
import { supabase } from '../lib/supabase'
import MainLayout from '../layouts/MainLayout.astro';
import HuggingFaceTrendList from '../components/HuggingFaceTrendList';
import Button from '../components/ui/Button.astro';
import { ArrowLeft } from 'lucide-react';

interface HuggingFaceModel {
  model_id: string
  url: string
  description_cn?: string
  likes: number
  downloads: number
  trending_score: number
  pipeline_tag?: string
  tags?: string[]
  ai_reason?: string
  fetched_date: string
}

let models: HuggingFaceModel[] = []
let error: string | null = null

if (supabase) {
  try {
    const { data, error: fetchError } = await supabase
      .from('huggingface_trending')
      .select('model_id, url, description_cn, likes, downloads, trending_score, pipeline_tag, tags, ai_reason, fetched_date')
      .order('fetched_date', { ascending: false })
      .order('trending_score', { ascending: false })
      .limit(30)

    if (fetchError) {
      error = fetchError.message
    } else {
      models = data || []
    }
  } catch (e) {
    error = e instanceof Error ? e.message : 'Failed to fetch models'
  }
}
---

<MainLayout title="HuggingFace Trending - Hotspot">
  <div class="max-w-7xl mx-auto">
    <div class="mb-8 text-center">
      <div class="mb-6 flex justify-center">
        <Button href={import.meta.env.BASE_URL} variant="ghost" size="sm" class="gap-1 text-slate-500 hover:text-slate-900">
          <ArrowLeft size={16} />
          返回首页
        </Button>
      </div>
      <h1 class="text-3xl md:text-4xl font-extrabold text-slate-900 mb-3 tracking-tight">
        HuggingFace <span class="text-transparent bg-clip-text bg-gradient-to-r from-yellow-500 to-orange-500">Trending</span>
      </h1>
      <p class="text-slate-500 text-lg">热门 AI 模型实时榜单</p>
    </div>

    {error ? (
      <div class="text-center py-12 bg-white rounded-xl border border-slate-200 shadow-sm">
        <p class="text-semantic-error">加载失败: {error}</p>
      </div>
    ) : (
      <HuggingFaceTrendList client:load initialModels={models} />
    )}
  </div>

  <script>
    import { trackPageView } from '../lib/analytics';
    trackPageView();
  </script>
</MainLayout>
