---
import { supabase } from '../lib/supabase'
import Navigation from '../components/Navigation.astro';
import HuggingFaceTrendList from '../components/HuggingFaceTrendList';

interface HuggingFaceModel {
  model_id: string
  url: string
  description_cn?: string
  likes: number
  downloads: number
  trending_score: number
  pipeline_tag?: string
  tags?: string[]
  ai_reason?: string
  fetched_date: string
}

let models: HuggingFaceModel[] = []
let error: string | null = null

if (supabase) {
  try {
    const { data, error: fetchError } = await supabase
      .from('huggingface_trending')
      .select('model_id, url, description_cn, likes, downloads, trending_score, pipeline_tag, tags, ai_reason, fetched_date')
      .order('fetched_date', { ascending: false })
      .order('trending_score', { ascending: false })
      .limit(30)

    if (fetchError) {
      error = fetchError.message
    } else {
      models = data || []
    }
  } catch (e) {
    error = e instanceof Error ? e.message : 'Failed to fetch models'
  }
} else {
  // Similarly, might fail in dev if env not set
}
---

<html lang="zh-CN">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
    <meta name="viewport" content="width=device-width" />
    <meta name="generator" content={Astro.generator} />
    <title>HuggingFace Trending - Hotspot</title>
  </head>
  <body>
    <main>
      <Navigation />
      <header class="hero">
        <h1>HuggingFace Trending</h1>
        <p>热门 AI 模型实时榜单</p>
      </header>

      {error ? (
        <div class="error-message">
          <p>加载失败: {error}</p>
        </div>
      ) : (
        <HuggingFaceTrendList client:load initialModels={models} />
      )}
    </main>

    <script>
      import { trackPageView } from '../lib/analytics';
      trackPageView();
    </script>
  </body>
</html>

<style>
  body {
    margin: 0;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
    background: #fffbf5; /* Very subtle warm background */
    min-height: 100vh;
    color: #1f2937;
  }

  main {
    padding: 2rem 1rem;
    max-width: 1400px; /* Slightly wider for the grid */
    margin: 0 auto;
  }
</style>

<script>
  import '../styles/huggingface.css';
</script>
